<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Weather in Your Terminal — Web</title>
  <style>
    /* (Your CSS here, same as before) */
    :root{
      --bg:#0f1724; --card:#0b1220; --accent:#4fd1c5; --muted:#94a3b8;
      --glass: rgba(255,255,255,0.04);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#081028 0%, #031126 100%);color:#e6eef6}
    .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:28px}
    .card{width:100%;max-width:760px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;box-shadow:0 8px 30px rgba(2,6,23,0.6);padding:22px;backdrop-filter: blur(6px)}
    header{display:flex;align-items:center;gap:14px}
    h1{margin:0;font-size:1.15rem}
    p.lead{margin:0;color:var(--muted);font-size:.92rem}
    .grid{display:grid;grid-template-columns:1fr 220px;gap:18px;margin-top:16px}
    .main{padding:16px;background:var(--card);border-radius:10px}
    .side{padding:14px;background:var(--glass);border-radius:10px;display:flex;flex-direction:column;gap:10px;align-items:center;justify-content:center}
    .big-temp{font-size:3.4rem;margin:0;line-height:1}
    .meta{color:var(--muted);margin-top:6px}
    .icon{font-size:3.2rem}
    .btn{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--accent);padding:8px 12px;border-radius:8px;cursor:pointer}
    .small{font-size:.87rem;color:var(--muted)}
    .error{color:#ff7b7b;background:rgba(255,123,123,0.06);padding:8px;border-radius:8px}
    @media(max-width:680px){.grid{grid-template-columns:1fr;}.side{flex-direction:row;gap:12px;padding:12px}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="main">
      <header>
        <div style="width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#60a5fa);display:flex;align-items:center;justify-content:center;font-weight:700">W</div>
        <div>
          <h1>Local Weather</h1>
          <p class="lead">Automatically detects your location and shows the current weather.</p>
        </div>
        <div style="margin-left:auto">
          <button id="refreshBtn" class="btn" title="Refresh weather">Refresh</button>
        </div>
      </header>

      <div id="status" style="margin-top:12px" class="small">Initializing…</div>

      <div class="grid">
        <div class="main" id="mainCard">
          <div id="content">
            <div style="display:flex;align-items:center;gap:18px">
              <div class="icon" id="weatherIcon">⛅</div>
              <div>
                <p id="place" style="margin:0;font-weight:600">—</p>
                <p id="desc" class="small" style="margin:6px 0 0 0;color:var(--muted)">—</p>
              </div>
            </div>

            <div style="margin-top:18px">
              <p class="big-temp" id="temp">--°C</p>
              <p class="meta" id="more">Feels like — · Humidity — · Wind —</p>
            </div>
          </div>
        </div>

        <aside class="side">
          <div style="text-align:center">
            <div class="small">Last updated</div>
            <div id="updated" style="font-weight:600;margin-top:6px">—</div>
          </div>

          <div style="height:1px;width:100%;background:rgba(255,255,255,0.02)"></div>

          <div style="text-align:center">
            <div class="small">Location method</div>
            <div id="method" style="font-weight:600;margin-top:6px">—</div>
          </div>
        </aside>
      </div>

      <div id="errorBox" style="margin-top:14px;display:none"></div>

      <footer style="margin-top:16px;color:var(--muted);font-size:.88rem">
        This site uses <strong>Open-Meteo</strong> for weather and free IP location services. No IPs are stored.
      </footer>
    </div>
  </div>

  <script>
    const iconMap = {
      0: '☀️', 1: '🌤️', 2: '⛅', 3: '☁️',
      45: '🌫️', 48: '🌫️',
      51: '🌦️', 53: '🌧️', 55: '🌧️',
      61: '🌧️', 63: '🌧️', 65: '⛈️',
      71: '🌨️', 73: '🌨️', 75: '🌨️',
      80: '🌦️', 81: '🌧️', 82: '⛈️',
      95: '⛈️', 96: '⛈️', 99: '⛈️'
    };

    const statusEl = document.getElementById('status');
    const methodEl = document.getElementById('method');
    const placeEl = document.getElementById('place');
    const descEl = document.getElementById('desc');
    const tempEl = document.getElementById('temp');
    const moreEl = document.getElementById('more');
    const iconEl = document.getElementById('weatherIcon');
    const updatedEl = document.getElementById('updated');
    const errorBox = document.getElementById('errorBox');
    const refreshBtn = document.getElementById('refreshBtn');

    function fmtDate(ts) {
      return new Date(ts).toLocaleString();
    }

    function weatherText(code) {
      const map = {
        0: 'Clear sky', 1: 'Mainly clear', 2: 'Partly cloudy', 3: 'Overcast',
        45: 'Fog', 48: 'Fog',
        51: 'Rain / Drizzle', 53: 'Rain / Drizzle', 55: 'Rain / Drizzle',
        61: 'Thunderstorm / Heavy rain', 63: 'Thunderstorm / Heavy rain', 65: 'Thunderstorm / Heavy rain',
        71: 'Snow', 73: 'Snow', 75: 'Snow',
        80: 'Rain / Drizzle', 81: 'Rain / Drizzle', 82: 'Thunderstorm / Heavy rain',
        95: 'Thunderstorm / Heavy rain', 96: 'Thunderstorm / Heavy rain', 99: 'Thunderstorm / Heavy rain'
      };
      return map[code] || 'Unknown';
    }

    async function getLocationViaOpenMeteoIP() {
      statusEl.textContent = 'Detecting location via Open-Meteo IP…';
      const res = await fetch('https://api.open-meteo.com/v1/ip');
      const j = await res.json();
      if (!j.latitude || !j.longitude) throw new Error('Open-Meteo IP location failed');
      return {
        lat: j.latitude,
        lon: j.longitude,
        city: j.city || '',
        country: j.country || ''
      };
    }

    async function getLocationViaIpapi() {
      statusEl.textContent = 'Detecting location via ipapi.co fallback…';
      const res = await fetch('https://ipapi.co/json/');
      const j = await res.json();
      if (!j.latitude || !j.longitude) throw new Error('ipapi.co location failed');
      return {
        lat: j.latitude,
        lon: j.longitude,
        city: j.city || '',
        country: j.country_name || ''
      };
    }

    async function fetchWeather(lat, lon) {
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&timezone=auto`;
      const res = await fetch(url);
      if (!res.ok) throw new Error('Weather fetch failed');
      return res.json();
    }

    async function showWeather() {
      errorBox.style.display = 'none';
      try {
        // Try Open-Meteo IP lookup first
        let loc;
        try {
          loc = await getLocationViaOpenMeteoIP();
          methodEl.textContent = 'Open-Meteo IP lookup';
        } catch {
          // fallback to ipapi.co
          loc = await getLocationViaIpapi();
          methodEl.textContent = 'ipapi.co fallback lookup';
        }

        statusEl.textContent = 'Fetching weather…';
        const w = await fetchWeather(loc.lat, loc.lon);
        const cw = w.current_weather;
        if (!cw) throw new Error('No current weather returned');

        placeEl.textContent = loc.city && loc.country ? `${loc.city}, ${loc.country}` : 'Unknown location';
        iconEl.textContent = iconMap[cw.weathercode] || '🌤️';
        descEl.textContent = weatherText(cw.weathercode);
        tempEl.textContent = `${Math.round(cw.temperature)}°C`;
        moreEl.textContent = `Wind ${Math.round(cw.windspeed)} km/h · Direction ${Math.round(cw.winddirection)}°`;
        updatedEl.textContent = fmtDate(Date.now());

        statusEl.textContent = 'Done';
      } catch (err) {
        console.error(err);
        statusEl.textContent = 'Error';
        errorBox.style.display = 'block';
        errorBox.className = 'error';
        errorBox.textContent = 'Could not load weather: ' + (err.message || err);
      }
    }

    refreshBtn.addEventListener('click', () => {
      statusEl.textContent = 'Refreshing…';
      showWeather();
    });

    showWeather();
  </script>
</body>
</html>
